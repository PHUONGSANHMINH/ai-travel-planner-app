
const {
  GoogleGenerativeAI,
  HarmCategory,
  HarmBlockThreshold,
} = require("@google/generative-ai");

const apiKey = 'AIzaSyCoiykPeqly7h9VkvpvDjN--TaTWxPfioE';
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
  model: "gemini-1.5-flash",
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 64,
  maxOutputTokens: 8192,
  responseMimeType: "application/json",
};


export const chatSession = model.startChat({
  generationConfig,
  // safetySettings: Adjust safety settings
  // See https://ai.google.dev/gemini-api/docs/safety-settings
  history: [
    {
      "role": "user",
        "parts": [
          {
            "text": "Generate Travel Plan for Location: Thanh pho Da Nang, Viet Nam, for 2 Days and 1 Night for A Couple with a Moderate budget with a Flight details, Flight Price with Booking url, Hotels options list with HotelName, Hotel address, Price, hotel image url, geo coordinates, rating, descriptions and Places to visit nearby with placeName, Place Details, Place Image Url, Geo Coordinates, ticket Pricing, Time t travel each of the location for 2 days and 1 night with each day plan with best time to visit in JSON format."
          },
        ]
    },
    {
      "role": "model",
        "parts": [
          {
            "text": "Here's a breakdown of the thought process to generate the Da Nang travel plan:\n\n1.  **Understand the Core Request:** The user wants a 2-day, 1-night travel plan for a couple visiting Da Nang, Vietnam. Key constraints are:\n    *   **Location:** Da Nang, Vietnam.\n    *   **Duration:** 2 Days / 1 Night.\n    *   **Target Audience:** A couple.\n    *   **Budget:** Moderate.\n    *   **Specific Inclusions:**\n        *   Flight details (including price and booking URL - *this is tricky, needs a disclaimer*).\n        *   Hotel options (name, address, price, image URL, geo-coordinates, rating, description, nearby places).\n        *   Places to visit (name, details, image URL, geo-coordinates, ticket pricing, travel time).\n        *   Detailed daily itinerary (Day 1, Day 2) with timings.\n        *   Best time to visit Da Nang.\n    *   **Output Format:** JSON.\n\n2.  **Structure the JSON:** A logical structure is crucial for JSON. I'll use a nested approach:\n    *   Root object containing overall trip info.\n    *   `tripDetails`: Basic info like location, duration, budget, target audience.\n    *   `bestTimeToVisit`: General advice on Da Nang's climate.\n    *   `flightDetails`: Placeholder for flight info (acknowledging limitations).\n    *   `hotelOptions`: An array of hotel objects.\n    *   `dailyItinerary`: An array of day objects (Day 1, Day 2).\n        *   Each `day` object will contain:\n            *   `dayNumber`.\n            *   `theme` (optional, but helpful).\n            *   `schedule`: An array of activity objects.\n                *   Each `activity` object will have: `time`, `activityName`, `description`, `locationDetails` (optional, referencing `placesToVisit`), `estimatedDuration`, `notes`.\n    *   `placesToVisit`: A separate array of detailed place objects, referenced by the itinerary and hotels. This avoids repetition.\n\n3.  **Content Generation - Step-by-Step:**\n\n    *   **`tripDetails`:** Straightforward based on the prompt. Define \"Moderate Budget\" loosely (e.g., mid-range hotels, mix of local food and some nicer meals, standard activities).\n    *   **`bestTimeToVisit`:** Recall or look up Da Nang's climate. Dry season (Feb-Aug) is generally best. Mention potential typhoon season (Sep-Nov).\n    *   **`flightDetails`:**\n        *   **Challenge:** Real-time flight prices and booking URLs are dynamic and depend on origin, dates, and availability. Providing fixed ones is impossible and potentially misleading.\n        *   **Solution:** Provide *example* flight details (common airline like Vietnam Airlines or VietJet), *estimated* price range (for a typical domestic or regional flight), and *links to popular booking platforms* (Skyscanner, Google Flights, airline sites) instead of a specific booking URL. Add a clear disclaimer about price volatility. *Self-correction: Initially thought about faking a URL, but that's bad practice. Using general booking site links is better.*\n    *   **`hotelOptions`:**\n        *   **Selection Criteria:** Moderate budget, good reviews (4+ stars usually), suitable for couples, reasonably central or near key attractions. Aim for 2-3 diverse options.\n        *   **Information Gathering (Simulated):** Search for \"mid-range hotels Da Nang couple\" on booking sites (Booking.com, Agoda). Look for hotels near the beach (My Khe) or the Han River.\n        *   **Data Points:** Extract Name, Address, *Estimated* Price Range (e.g., $40-$80/night), Rating, brief Description (highlighting couple-friendly features like pools, views), Geo Coordinates (use Google Maps), find a representative Image URL (use placeholder or generic image source if specific API isn't available).\n        *   **Nearby Places:** List 1-2 attractions close to *each* hotel from the `placesToVisit` list (create this list concurrently or afterwards).\n    *   **`placesToVisit`:**\n        *   **Selection Criteria:** Must-sees for a short trip, variety (beach, culture, views, food), suitable for couples. For 2 days:\n            *   My Khe Beach (Relaxation)\n            *   Marble Mountains (Culture, Views)\n            *   Dragon Bridge (Iconic, Evening activity)\n            *   Han Market (Local life, Souvenirs, Food)\n            *   Linh Ung Pagoda / Lady Buddha (Spiritual, Views)\n            *   Maybe Son Tra Peninsula (Views, Nature - combine with Pagoda).\n        *   **Information Gathering (Simulated):** Search for \"top attractions Da Nang\".\n        *   **Data Points:** Extract Name, Description (what makes it special), Geo Coordinates, *Estimated* Ticket Price (some are free, others have fees), find an Image URL.\n    *   **`dailyItinerary`:**\n        *   **Logistics:** How to get around? Mention Grab (ride-hailing) or renting a scooter as common moderate-budget options. Factor in travel time between locations.\n        *   **Day 1:**\n            *   Arrival & Check-in.\n            *   Afternoon: Something relatively close to typical hotel areas. Marble Mountains is a good option - substantial but not *all* day.\n            *   Late Afternoon/Evening: My Khe Beach for relaxation/sunset.\n            *   Evening: Dinner (suggest local seafood), Dragon Bridge fire/water show (if Saturday/Sunday).\n        *   **Day 2:**\n            *   Morning: Son Tra Peninsula (Linh Ung Pagoda/Lady Buddha). Offers great morning views.\n            *   Late Morning/Lunch: Han Market for local experience and lunch.\n            *   Afternoon: Flexible - maybe more beach time, souvenir shopping, or just relaxing before departure.\n            *   Departure: Check-out, travel to airport.\n        *   **Refinement:** Add specific times (e.g., 09:00, 14:00), brief descriptions for each activity slot, estimated durations, and notes (e.g., \"Wear comfortable shoes for Marble Mountains\"). Ensure the flow is logical and doesn't involve excessive backtracking. Estimate travel times between key locations (e.g., Hotel -> Marble Mountains ~20 mins).\n    *   **Geo Coordinates & Image URLs:** Use Google Maps to find coordinates. For images, use placeholder URLs or search for publicly available images (like from Wikimedia Commons or tourism sites, *acknowledging source if necessary*). *Self-correction: Ensure image URLs are publicly accessible and likely stable.*\n    *   **Pricing:** Research typical entrance fees for Marble Mountains, etc. State \"Free\" where applicable. Use VND (Vietnamese Dong) and maybe an approximate USD equivalent for clarity. Note that prices can change.\n\n4.  **JSON Formatting:** Assemble all the collected data into the structured JSON format defined in step 2. Pay close attention to syntax: curly braces `{}`, square brackets `[]`, commas `,`, quotes `\"\"`, colons `:`. Use an online JSON validator to check for errors before finalizing. Ensure data types are correct (strings, numbers, booleans, arrays, objects).\n\n5.  **Review and Refine:**\n    *   Read through the entire JSON output.\n    *   Does it directly address all parts of the prompt?\n    *   Is the itinerary realistic for 2 days? Is it too rushed or too empty?\n    *   Are the budget considerations reflected (moderate hotel choices, mix of free/paid activities)?\n    *   Are the disclaimers about dynamic pricing (flights, hotels) clear?\n    *   Is the JSON valid?\n    *   Are the descriptions helpful?\n    *   Are coordinates and image URLs plausible? (Even if placeholders, they should look like real data).\n\nThis systematic approach ensures all requirements are met, potential issues (like dynamic pricing) are handled appropriately, and the final output is well-structured and informative."
          },
          {
            "text": "```json\n{\n  \"tripDetails\": {\n    \"location\": \"Thanh pho Da Nang, Viet Nam\",\n    \"duration\": \"2 Days / 1 Night\",\n    \"travelers\": \"A Couple\",\n    \"budget\": \"Moderate\",\n    \"description\": \"A balanced itinerary for a couple exploring the highlights of Da Nang, blending culture, relaxation, and scenic views within a moderate budget.\"\n  },\n  \"bestTimeToVisit\": {\n    \"period\": \"February to August\",\n    \"details\": \"This period generally offers sunny days and calm seas, ideal for beach activities and sightseeing. September to January can experience rain and occasional typhoons, although travel is still possible.\"\n  },\n  \"flightDetails\": {\n    \"note\": \"Flight prices are highly dynamic and depend on origin, booking time, and airline. The following is an example and requires checking real-time data.\",\n    \"exampleOrigin\": \"Ho Chi Minh City (SGN) or Hanoi (HAN)\",\n    \"exampleAirline\": \"VietJet Air or Vietnam Airlines\",\n    \"estimatedPriceRange\": \"VND 1,000,000 - 2,500,000 (approx. $40 - $100 USD) round trip per person, booked in advance.\",\n    \"bookingSuggestionUrls\": [\n      \"https://www.google.com/flights\",\n      \"https://www.skyscanner.com\",\n      \"https://www.vietjetair.com/\",\n      \"https://www.vietnamairlines.com/\"\n    ],\n    \"arrivalAirport\": \"Da Nang International Airport (DAD)\"\n  },\n  \"hotelOptions\": [\n    {\n      \"hotelName\": \"Sofia Suite Hotel & Spa\",\n      \"address\": \"Lô I-A2.1 Võ Văn Kiệt, An Hải Đông, Sơn Trà, Đà Nẵng 550000, Vietnam\",\n      \"priceRangePerNight\": \"VND 900,000 - 1,500,000 (approx. $35 - $60 USD)\",\n      \"imageUrl\": \"https://lh3.googleusercontent.com/p/AF1QipO_e3iP3q7-9Lz_WzB1v6Z_iH0xQo9e7W4L_hVj=s1360-w1360-h1020\",\n      \"geoCoordinates\": {\n        \"latitude\": 16.0585,\n        \"longitude\": 108.2431\n      },\n      \"rating\": 4.5,\n      \"description\": \"Modern hotel with comfortable suites, often featuring kitchenettes. Includes a spa and rooftop pool with city/partial sea views. Close proximity to My Khe Beach.\",\n      \"placesNearby\": [\n        \"My Khe Beach\",\n        \"Dragon Bridge\"\n      ]\n    },\n    {\n      \"hotelName\": \"Minh Toan SAFI Ocean Hotel\",\n      \"address\": \"224 Võ Nguyên Giáp, Phước Mỹ, Sơn Trà, Đà Nẵng 550000, Vietnam\",\n      \"priceRangePerNight\": \"VND 1,200,000 - 2,000,000 (approx. $48 - $80 USD)\",\n      \"imageUrl\": \"https://lh3.googleusercontent.com/p/AF1QipMq5M8lF9wA7ZlQx8x0P-0o9H9f6tG_b7R_n3yF=s1360-w1360-h1020\",\n      \"geoCoordinates\": {\n        \"latitude\": 16.0529,\n        \"longitude\": 108.2478\n      },\n      \"rating\": 4.6,\n      \"description\": \"Located directly opposite My Khe Beach, offering stunning sea views from many rooms. Features an outdoor pool, fitness center, and restaurant.\",\n      \"placesNearby\": [\n        \"My Khe Beach\",\n        \"Bien Dong Park\"\n      ]\n    },\n    {\n      \"hotelName\": \"San Marino Boutique Danang\",\n      \"address\": \"161-163-165 Võ Văn Kiệt, An Hải Đông, Sơn Trà, Đà Nẵng 550000, Vietnam\",\n      \"priceRangePerNight\": \"VND 1,000,000 - 1,800,000 (approx. $40 - $72 USD)\",\n      \"imageUrl\": \"https://lh3.googleusercontent.com/p/AF1QipM_z7-q2I3x9Zt-Q_o_s8B_z1z_gP0b3O_m0hXf=s1360-w1360-h1020\",\n      \"geoCoordinates\": {\n        \"latitude\": 16.0588,\n        \"longitude\": 108.2425\n      },\n      \"rating\": 4.7,\n      \"description\": \"Boutique hotel with stylish rooms, a rooftop pool offering panoramic views, and attentive service. Walking distance to the beach and various restaurants.\",\n      \"placesNearby\": [\n        \"My Khe Beach\",\n        \"Dragon Bridge\"\n      ]\n    }\n  ],\n  \"placesToVisit\": [\n    {\n      \"placeName\": \"My Khe Beach (Bãi biển Mỹ Khê)\",\n      \"details\": \"Famous for its long stretch of white sand, gentle waves, and clear water. Ideal for swimming, sunbathing, water sports, and enjoying fresh seafood at nearby restaurants.\",\n      \"imageUrl\": \"https://dynamic-media-cdn.tripadvisor.com/media/photo-o/17/94/31/a6/my-khe-beach.jpg?w=1200&h=-1&s=1\",\n      \"geoCoordinates\": {\n        \"latitude\": 16.0560,\n        \"longitude\": 108.2480\n      },\n      \"ticketPricing\": \"Free access\",\n      \"estimatedTimeNeeded\": \"2-4 hours\"\n    },\n    {\n      \"placeName\": \"Marble Mountains (Ngũ Hành Sơn)\",\n      \"details\": \"A cluster of five limestone and marble hills representing the five elements. Explore caves, pagodas, and viewpoints offering panoramic views of Da Nang and the coast. Requires climbing stairs.\",\n      \"imageUrl\": \"https://dynamic-media-cdn.tripadvisor.com/media/photo-o/1a/60/81/10/caption.jpg?w=1200&h=-1&s=1\",\n      \"geoCoordinates\": {\n        \"latitude\": 16.0038,\n        \"longitude\": 108.2637\n      },\n      \"ticketPricing\": \"Entrance: VND 40,000/person. Optional elevator: VND 15,000/person/way. Am Phu Cave: VND 20,000/person.\",\n      \"estimatedTimeNeeded\": \"2.5 - 3.5 hours\"\n    },\n    {\n      \"placeName\": \"Dragon Bridge (Cầu Rồng)\",\n      \"details\": \"An iconic bridge shaped like a dragon, crossing the Han River. Famous for its fire and water breathing show on Saturday and Sunday nights.\",\n      \"imageUrl\": \"https://dynamic-media-cdn.tripadvisor.com/media/photo-o/0d/9c/19/d8/dragon-bridge.jpg?w=1200&h=-1&s=1\",\n      \"geoCoordinates\": {\n        \"latitude\": 16.0617,\n        \"longitude\": 108.2276\n      },\n      \"ticketPricing\": \"Free to view. Show at 9:00 PM on Sat & Sun.\",\n      \"estimatedTimeNeeded\": \"30 mins - 1 hour (longer if watching the show)\"\n    },\n    {\n      \"placeName\": \"Linh Ung Pagoda & Lady Buddha (Chùa Linh Ứng - Bãi Bụt)\",\n      \"details\": \"Located on Son Tra Peninsula, this pagoda features the tallest Lady Buddha statue in Vietnam (67m), offering breathtaking views of the coastline and Da Nang city.\",\n      \"imageUrl\": \"https://dynamic-media-cdn.tripadvisor.com/media/photo-o/0e/c0/6c/44/chua-linh-ung.jpg?w=1200&h=-1&s=1\",\n      \"geoCoordinates\": {\n        \"latitude\": 16.1008,\n        \"longitude\": 108.2797\n      },\n      \"ticketPricing\": \"Free access (donations welcome)\",\n      \"estimatedTimeNeeded\": \"1.5 - 2 hours\"\n    },\n    {\n      \"placeName\": \"Han Market (Chợ Hàn)\",\n      \"details\": \"A bustling local market offering a variety of goods including fresh produce, local snacks, clothing, souvenirs, and dried goods. Great place to experience local life and grab cheap eats.\",\n      \"imageUrl\": \"https://dynamic-media-cdn.tripadvisor.com/media/photo-o/0e/8f/69/f0/han-market.jpg?w=1200&h=-1&s=1\",\n      \"geoCoordinates\": {\n        \"latitude\": 16.0685,\n        \"longitude\": 108.2239\n      },\n      \"ticketPricing\": \"Free access\",\n      \"estimatedTimeNeeded\": \"1 - 1.5 hours\"\n    }\n  ],\n  \"dailyItinerary\": [\n    {\n      \"dayNumber\": 1,\n      \"theme\": \"Culture, Coastline & Evening Sparkle\",\n      \"schedule\": [\n        {\n          \"time\": \"12:00 - 13:00\",\n          \"activityName\": \"Arrival & Airport Transfer\",\n          \"description\": \"Arrive at Da Nang International Airport (DAD). Take a taxi or Grab (ride-hailing app, recommended & affordable) to your hotel.\",\n          \"estimatedDuration\": \"15-25 minutes travel\",\n          \"notes\": \"Ensure you have the Grab app installed or agree on taxi fare beforehand.\"\n        },\n        {\n          \"time\": \"13:00 - 14:00\",\n          \"activityName\": \"Hotel Check-in & Freshen Up\",\n          \"description\": \"Check into your chosen hotel, leave luggage, and take a short break.\",\n          \"estimatedDuration\": \"1 hour\"\n        },\n        {\n          \"time\": \"14:00 - 14:30\",\n          \"activityName\": \"Travel to Marble Mountains\",\n          \"description\": \"Take a Grab/taxi to Marble Mountains.\",\n          \"estimatedDuration\": \"15-20 minutes travel\"\n        },\n        {\n          \"time\": \"14:30 - 17:30\",\n          \"activityName\": \"Explore Marble Mountains\",\n          \"locationDetails\": \"Marble Mountains (Ngũ Hành Sơn)\",\n          \"description\": \"Discover the caves, pagodas, and viewpoints. Consider taking the elevator up one way if preferred. Visit Am Phu Cave (Hell Cave).\",\n          \"estimatedDuration\": \"3 hours\",\n          \"notes\": \"Wear comfortable shoes and clothing suitable for climbing stairs. Bring water.\"\n        },\n        {\n          \"time\": \"17:30 - 19:00\",\n          \"activityName\": \"Relax at My Khe Beach\",\n          \"locationDetails\": \"My Khe Beach (Bãi biển Mỹ Khê)\",\n          \"description\": \"Head back towards the coast. Enjoy a relaxing walk on the beach, swim, or simply enjoy the sunset.\",\n          \"estimatedDuration\": \"1.5 hours\",\n          \"notes\": \"Many beachfront cafes and bars for a drink.\"\n        },\n        {\n          \"time\": \"19:00 - 20:30\",\n          \"activityName\": \"Dinner\",\n          \"description\": \"Enjoy dinner at a local seafood restaurant near the beach or explore options closer to your hotel.\",\n          \"estimatedDuration\": \"1.5 hours\",\n          \"notes\": \"Budget around VND 300,000 - 600,000 ($12-$24) for a moderate seafood dinner for two.\"\n        },\n        {\n          \"time\": \"20:30 - 21:30\",\n          \"activityName\": \"Dragon Bridge Viewing\",\n          \"locationDetails\": \"Dragon Bridge (Cầu Rồng)\",\n          \"description\": \"Walk or take a short ride to the Dragon Bridge. Find a good spot along the riverfront promenade. If it's Saturday or Sunday, prepare for the 9:00 PM fire and water show.\",\n          \"estimatedDuration\": \"1 hour\",\n          \"notes\": \"The show attracts crowds, arrive slightly early for a good view.\"\n        }\n      ]\n    },\n    {\n      \"dayNumber\": 2,\n      \"theme\": \"Scenic Views, Local Life & Departure\",\n      \"schedule\": [\n        {\n          \"time\": \"08:00 - 09:00\",\n          \"activityName\": \"Breakfast\",\n          \"description\": \"Enjoy breakfast at your hotel or a nearby local cafe (try Banh Mi or Mi Quang).\",\n          \"estimatedDuration\": \"1 hour\"\n        },\n        {\n          \"time\": \"09:00 - 09:30\",\n          \"activityName\": \"Travel to Son Tra Peninsula\",\n          \"description\": \"Take a Grab/taxi towards Linh Ung Pagoda on Son Tra Peninsula.\",\n          \"estimatedDuration\": \"20-30 minutes travel\",\n          \"notes\": \"The road up offers nice views.\"\n        },\n        {\n          \"time\": \"09:30 - 11:00\",\n          \"activityName\": \"Visit Linh Ung Pagoda & Lady Buddha\",\n          \"locationDetails\": \"Linh Ung Pagoda & Lady Buddha (Chùa Linh Ứng - Bãi Bụt)\",\n          \"description\": \"Explore the pagoda complex, admire the giant Lady Buddha statue, and enjoy the panoramic coastal views.\",\n          \"estimatedDuration\": \"1.5 hours\",\n          \"notes\": \"Dress respectfully (shoulders and knees covered).\"\n        },\n        {\n          \"time\": \"11:00 - 11:30\",\n          \"activityName\": \"Travel to Han Market\",\n          \"description\": \"Take a Grab/taxi back towards the city center to Han Market.\",\n          \"estimatedDuration\": \"25-30 minutes travel\"\n        },\n        {\n          \"time\": \"11:30 - 13:00\",\n          \"activityName\": \"Explore Han Market & Lunch\",\n          \"locationDetails\": \"Han Market (Chợ Hàn)\",\n          \"description\": \"Wander through the bustling market, browse local goods, and have lunch at one of the food stalls inside or nearby for authentic local flavors.\",\n          \"estimatedDuration\": \"1.5 hours\",\n          \"notes\": \"Try local specialties like Bun Thit Nuong or Banh Xeo. Bargaining is common for non-food items.\"\n        },\n        {\n          \"time\": \"13:00 - 14:30\",\n          \"activityName\": \"Optional: Coffee/Relax/Souvenirs\",\n          \"description\": \"Enjoy a Vietnamese coffee at a trendy cafe, relax by the hotel pool, or do some last-minute souvenir shopping.\",\n          \"estimatedDuration\": \"1.5 hours\"\n        },\n        {\n          \"time\": \"14:30 - 15:00\",\n          \"activityName\": \"Check-out & Travel to Airport\",\n          \"description\": \"Check out from your hotel and take a Grab/taxi to Da Nang International Airport (DAD).\",\n          \"estimatedDuration\": \"15-25 minutes travel\",\n          \"notes\": \"Allow ample time before your flight departure.\"\n        },\n        {\n          \"time\": \"15:00 onwards\",\n          \"activityName\": \"Departure\",\n          \"description\": \"Depart from Da Nang.\",\n          \"estimatedDuration\": \"\"\n        }\n      ]\n    }\n  ]\n}\n```"
          },
        ]
    },
  ],
});

// const result = await chatSession.sendMessage("INSERT_INPUT_HERE");
// console.log(result.response.text());
